<script>
    function calculateResults() {
        let a = parseFloat(document.getElementById("a").value);
        let b = parseFloat(document.getElementById("b").value);
        let c = parseFloat(document.getElementById("c").value);
        let d = parseFloat(document.getElementById("d").value);

        if (!a || !b || !c || !d) {
            alert("Please enter valid numbers.");
            return;
        }
        
        let total_sample = a + b + c + d;
        let total_disease_positive = a + c;
        let total_unexposed = c + d;
        
        let risk_total = total_disease_positive / total_sample;
        let risk_unexposed = c / total_unexposed;
        
        let relativeRisk = (a / (a + b)) / (c / (c + d));
        let standardErrorRR = 1.96 * Math.sqrt((1 / a) - (1 / (a + b)) + (1 / c) - (1 / (c + d)));
        let lowerRR = relativeRisk / standardErrorRR;
        let upperRR = relativeRisk * standardErrorRR;
        
        let riskDifference = (a / (a + b)) - (c / (c + d));
        let standardErrorRD = Math.sqrt(((a / (a + b)) * (1 - (a / (a + b))) / (a + b)) + ((c / (c + d)) * (1 - (c / (c + d))) / (c + d)));
        let lowerRD = riskDifference - 1.96 * standardErrorRD;
        let upperRD = riskDifference + 1.96 * standardErrorRD;
        
        let attributableFractionExposed = ((relativeRisk - 1) / relativeRisk);
        
        let SE_AFE = Math.sqrt((1 / a) - (1 / (a + b)));
        let lowerAFE = 1 - Math.exp(Math.log(1 - attributableFractionExposed) + (1.96 * SE_AFE));
        let upperAFE = 1 - Math.exp(Math.log(1 - attributableFractionExposed) - (1.96 * SE_AFE));
        
        lowerAFE = Math.max(0, lowerAFE) * 100;
        upperAFE = Math.min(100, upperAFE) * 100;
        
        let PAR = risk_total - risk_unexposed;
        let populationAttributableFraction = (PAR / (total_disease_positive / total_sample));
        
        let SE_PAF = Math.sqrt((b + (populationAttributableFraction * (a + d))) / (total_sample * c));
        
        let lowerPAF = 1 - Math.exp(Math.log(1 - populationAttributableFraction) + (1.96 * SE_PAF));
        let upperPAF = 1 - Math.exp(Math.log(1 - populationAttributableFraction) - (1.96 * SE_PAF));
        
        lowerPAF = Math.max(0, lowerPAF) * 100;
        upperPAF = Math.min(100, upperPAF) * 100;
        
        let SE_PAR = Math.sqrt(((total_disease_positive * (total_sample - total_disease_positive)) / Math.pow(total_sample, 3)) + ((c * (total_unexposed - c)) / Math.pow(total_unexposed, 3)));
        let lowerPAR = PAR - 1.96 * SE_PAR;
        let upperPAR = PAR + 1.96 * SE_PAR;
        
        document.getElementById("rr-result").innerText = relativeRisk.toFixed(3);
        document.getElementById("rr-ci").innerText = `(${lowerRR.toFixed(3)} – ${upperRR.toFixed(3)})`;
        document.getElementById("rd-result").innerText = riskDifference.toFixed(3);
        document.getElementById("rd-ci").innerText = `(${lowerRD.toFixed(3)} – ${upperRD.toFixed(3)})`;
        document.getElementById("afe-result").innerText = (attributableFractionExposed * 100).toFixed(3);
        document.getElementById("afe-ci").innerText = `(${lowerAFE.toFixed(3)} – ${upperAFE.toFixed(3)})`;
        document.getElementById("paf-result").innerText = (populationAttributableFraction * 100).toFixed(3);
        document.getElementById("paf-ci").innerText = `(${lowerPAF.toFixed(3)} – ${upperPAF.toFixed(3)})`;
        document.getElementById("par-result").innerText = PAR.toFixed(3);
        document.getElementById("par-ci").innerText = `(${lowerPAR.toFixed(3)} – ${upperPAR.toFixed(3)})`;
        
        document.getElementById("results-container").style.display = "block";
    }
</script>

