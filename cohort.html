function calculateResults() {
    let a = parseFloat(document.getElementById("a").value);
    let b = parseFloat(document.getElementById("b").value);
    let c = parseFloat(document.getElementById("c").value);
    let d = parseFloat(document.getElementById("d").value);

    if (!a || !b || !c || !d) {
        alert("Please enter valid numbers.");
        return;
    }
    
    // Risk calculations
    let riskExposed = a / (a + b);
    let riskUnexposed = c / (c + d);
    let relativeRisk = riskExposed / riskUnexposed;

    // RR Confidence Interval
    let lnRR = Math.log(relativeRisk);
    let seLogRR = Math.sqrt((1 - riskExposed)/(a * riskExposed) + (1 - riskUnexposed)/(c * riskUnexposed));
    let lowerRR = Math.exp(lnRR - 1.96 * seLogRR);
    let upperRR = Math.exp(lnRR + 1.96 * seLogRR);

    // Risk Difference and CI
    let riskDifference = riskExposed - riskUnexposed;
    let standardErrorRD = Math.sqrt(((riskExposed * (1 - riskExposed)) / (a + b)) + 
                                  ((riskUnexposed * (1 - riskUnexposed)) / (c + d)));
    let lowerRD = riskDifference - 1.96 * standardErrorRD;
    let upperRD = riskDifference + 1.96 * standardErrorRD;

    // Attributable Fraction in Exposed (AFe) and CI
    let attributableFractionExposed = ((relativeRisk - 1) / relativeRisk) * 100;
    let lowerAFE = (1 - (1/lowerRR)) * 100;  // Modified as requested
    let upperAFE = (1 - (1/upperRR)) * 100;  // Modified as requested

    // Population Attributable Fraction (PAF)
    let prevalenceExposed = (a + b) / (a + b + c + d);
    let paf = (prevalenceExposed * (relativeRisk - 1)) / 
              (1 + prevalenceExposed * (relativeRisk - 1)) * 100;
    
    // PAF Confidence Interval using delta method
    let sePAF = Math.sqrt(
        (prevalenceExposed * prevalenceExposed * Math.pow(relativeRisk, 2) * 
         ((1 - riskExposed)/(a * riskExposed) + (1 - riskUnexposed)/(c * riskUnexposed))) /
        Math.pow(1 + prevalenceExposed * (relativeRisk - 1), 4)
    );
    let lowerPAF = paf - (1.96 * sePAF * 100);
    let upperPAF = paf + (1.96 * sePAF * 100);

    // Population Attributable Risk (PAR)
    let totalRisk = (a + c) / (a + b + c + d);
    let par = totalRisk - riskUnexposed;
    
    // PAR Confidence Interval
    let sePAR = Math.sqrt(
        (totalRisk * (1 - totalRisk) / (a + b + c + d)) +
        (riskUnexposed * (1 - riskUnexposed) / (c + d))
    );
    let lowerPAR = par - (1.96 * sePAR);
    let upperPAR = par + (1.96 * sePAR);

    // Display results
    document.getElementById("rr-result").innerText = relativeRisk.toFixed(3);
    document.getElementById("rr-ci").innerText = `(${lowerRR.toFixed(3)} – ${upperRR.toFixed(3)})`;
    document.getElementById("rd-result").innerText = riskDifference.toFixed(3);
    document.getElementById("rd-ci").innerText = `(${lowerRD.toFixed(3)} – ${upperRD.toFixed(3)})`;
    document.getElementById("afe-result").innerText = attributableFractionExposed.toFixed(3);
    document.getElementById("afe-ci").innerText = `(${lowerAFE.toFixed(3)}% – ${upperAFE.toFixed(3)}%)`;
    document.getElementById("paf-result").innerText = paf.toFixed(3);
    document.getElementById("paf-ci").innerText = `(${lowerPAF.toFixed(3)}% – ${upperPAF.toFixed(3)}%)`;
    document.getElementById("par-result").innerText = par.toFixed(3);
    document.getElementById("par-ci").innerText = `(${lowerPAR.toFixed(3)} – ${upperPAR.toFixed(3)})`;
    document.getElementById("results-container").style.display = "block";
}
